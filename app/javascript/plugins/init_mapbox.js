import mapboxgl from 'mapbox-gl';
import MapboxGeocoder from '@mapbox/mapbox-gl-geocoder';


const initIndexMap = () => {
  const mapElement = document.getElementById('map');

  if (mapElement) { // only build a map if there's a div#map to inject into
    mapboxgl.accessToken = mapElement.dataset.mapboxApiKey;

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v10',
      center: [-73.61, 45.551],
      zoom: 9.5,
      attributionControl: false
    });

    map.on('load', function() {
      map.addLayer({
        'id': 'maine',
        'type': 'fill',
        'source': {
          'type': 'geojson',
          'data': {
            'type': 'Feature',
            'geometry': {
              'type': 'Polygon',
              'coordinates': [[[
              -73.63769695817628,
              45.60065715887518
              ],
              [
              -73.638060825036,
              45.600500944510046
              ],
              [
              -73.63819668206686,
              45.60041096877172
              ],
              [
              -73.63837719073972,
              45.60029142159522
              ],
              [
              -73.63869344857831,
              45.60008198791887
              ],
              [
              -73.63917255132827,
              45.59975266644094
              ],
              [
              -73.63934664670708,
              45.59960675803133
              ],
              [
              -73.63937070338892,
              45.59958657059614
              ],
              [
              -73.6396337438157,
              45.59936613025151
              ],
              [
              -73.63974474083686,
              45.59923028738585
              ],
              [
              -73.64037729859402,
              45.59845648503616
              ],
              [
              -73.64153154047482,
              45.597068831847714
              ],
              [
              -73.64257094199291,
              45.59581917705791
              ],
              [
              -73.64302164119677,
              45.59623473450577
              ],
              [
              -73.6444273226074,
              45.59754054267759
              ],
              [
              -73.6452827968572,
              45.59792336167039
              ],
              [
              -73.64529900055436,
              45.59813878069758
              ],
              [
              -73.64522902210543,
              45.598267017563266
              ],
              [
              -73.64513105472751,
              45.59836568274451
              ],
              [
              -73.64500506078681,
              45.598543305951004
              ],
              [
              -73.64490709276795,
              45.59864206092767
              ],
              [
              -73.64483709165415,
              45.59872098223839
              ],
              [
              -73.64454344938241,
              45.599243844675
              ],
              [
              -73.64447367473142,
              45.59941149705972
              ],
              [
              -73.64440400077528,
              45.59961856553283
              ],
              [
              -73.64402638913022,
              45.60022036518611
              ],
              [
              -73.64371857354449,
              45.60066441072081
              ],
              [
              -73.64355021153828,
              45.60073355585526
              ],
              [
              -73.64348058302261,
              45.6009604217781
              ],
              [
              -73.64355124240745,
              45.60113779614146
              ],
              [
              -73.6435521975645,
              45.60151233931955
              ],
              [
              -73.64334215250197,
              45.601739381486276
              ],
              [
              -73.6433294451802,
              45.60227169674108
              ],
              [
              -73.64316125344202,
              45.60240986449155
              ],
              [
              -73.64309194707015,
              45.602764877488084
              ],
              [
              -73.64255838069373,
              45.60367625764547
              ],
              [
              -73.6425109338101,
              45.603729771737605
              ],
              [
              -73.64253010207985,
              45.60378320271735
              ],
              [
              -73.64249235768172,
              45.60391022766962
              ],
              [
              -73.64231213134379,
              45.60418438614088
              ],
              [
              -73.64216032256599,
              45.60436500789862
              ],
              [
              -73.64188494386275,
              45.604645943404655
              ],
              [
              -73.64181967428239,
              45.60518048328179
              ],
              [
              -73.6418299992024,
              45.60550119973344
              ],
              [
              -73.64168161152892,
              45.605950710779354
              ],
              [
              -73.64161229128949,
              45.60630563268253
              ],
              [
              -73.64140212152006,
              45.60649325502915
              ],
              [
              -73.64117817616413,
              45.606838558861696
              ],
              [
              -73.6409399644338,
              45.607399769076345
              ],
              [
              -73.64071223953017,
              45.60767398344439
              ],
              [
              -73.64058874503777,
              45.60780777262765
              ],
              [
              -73.64042307432123,
              45.60816038245909
              ],
              [
              -73.64033908929143,
              45.60827882426325
              ],
              [
              -73.6402974197438,
              45.60844643930065
              ],
              [
              -73.64005969733584,
              45.608870590138366
              ],
              [
              -73.63994746653243,
              45.60890033482382
              ],
              [
              -73.63986340581668,
              45.608989169211405
              ],
              [
              -73.63987770749216,
              45.6091271083926
              ],
              [
              -73.63976550066619,
              45.60916675191345
              ],
              [
              -73.63921916172086,
              45.60974903286712
              ],
              [
              -73.639205389522,
              45.60986729822685
              ],
              [
              -73.6387153705188,
              45.61047911519409
              ],
              [
              -73.63863142677344,
              45.610617173746235
              ],
              [
              -73.63831213825881,
              45.6110375501109
              ],
              [
              -73.63824581000968,
              45.611157948745586
              ],
              [
              -73.63807813589416,
              45.61139365871842
              ],
              [
              -73.63790357384369,
              45.611624247247356
              ],
              [
              -73.63773396514713,
              45.61184844014776
              ],
              [
              -73.63740127916766,
              45.6122880881582
              ],
              [
              -73.63725945586445,
              45.61267576103002
              ],
              [
              -73.63725974914702,
              45.6127959890014
              ],
              [
              -73.63692786340866,
              45.6133510033824
              ],
              [
              -73.63604793931543,
              45.61557024856135
              ],
              [
              -73.6358016920777,
              45.61612506738997
              ],
              [
              -73.63419810966333,
              45.61837845190769
              ],
              [
              -73.63397048832022,
              45.618772970370934
              ],
              [
              -73.63381912210907,
              45.61916739905557
              ],
              [
              -73.63383827157854,
              45.619214172025
              ],
              [
              -73.63367678064968,
              45.61935465731661
              ],
              [
              -73.6336769551452,
              45.61942808989473
              ],
              [
              -73.63358188048443,
              45.619521791904106
              ],
              [
              -73.62266699175703,
              45.60923156684351
              ],
              [
              -73.62000765531086,
              45.6067215633531
              ],
              [
              -73.63739836393144,
              45.60078530625026
              ],
              [
              -73.63769695817628,
              45.60065715887518
              ]]]
            }
          }
        },
        'layout': {},
        'paint': {
          'fill-color': '#F78AE0',
          'fill-opacity': 0.5
        }
      });
     });

    map.addControl(new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      marker: {
      },
      mapboxgl: mapboxgl
    }));

    const markers = JSON.parse(mapElement.dataset.markers);
    if (markers !== null ) {
      markers.forEach((marker) => {
        new mapboxgl.Marker()
        .setLngLat([ marker.lng, marker.lat ])
        .addTo(map);
      });
    }


  }
};

// ==========================================================================================

document.querySelectorAll(".btn").forEach((btn) => {
  btn.addEventListener("click", (event) => {
    console.log(event);
  });
});


const initShowMap = () => {
  const mapElement = document.getElementById('show-map');

  if (mapElement) { // only build a map if there's a div#map to inject into
    mapboxgl.accessToken = mapElement.dataset.mapboxApiKey;
    const center = JSON.parse(mapElement.dataset.center)
    const coordinates = JSON.parse(mapElement.dataset.coordinates)

    const map = new mapboxgl.Map({
      container: 'show-map',
      style: 'mapbox://styles/mapbox/streets-v10',
      center: center,
      zoom: 13,
      attributionControl: false
    });

    map.on('load', function() {
      map.addLayer({
        'id': 'maine',
        'type': 'line',
        'source': {
          'type': 'geojson',
          'data': {
            'type': 'Feature',
            'geometry': {
              'type': 'Polygon',
              'coordinates': [coordinates]
            }
          }
        },
        'layout': {},
        'paint': {
          'line-color': '#FF6057',
          'line-width': 4
        }
      });
     });

    map.addControl(new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      marker: {
      },
      mapboxgl: mapboxgl
    }));

    const markers = JSON.parse(mapElement.dataset.restaurants);
    if (markers !== null ) {
      markers.forEach((marker) => {
        new mapboxgl.Marker()
        .setLngLat([ marker.lng, marker.lat ])
        .addTo(map);
      });
    }
  }
};

const initMapbox = () => {
  initIndexMap()
  initShowMap()
};

export { initMapbox };
